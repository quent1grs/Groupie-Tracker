<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage</title>
    <link rel="stylesheet" href="assets/css/homepage.css">
</head>    
<body>
    <div class="esection">
        <div class="container">
            <div class="row full-height justify-content-center">
                <div class="col-12 text-center align-self-center py-5">
                    <div class="section pb-5 pt-5 pt-sm-2 text-center">
                        <video autoplay muted loop id="bg-video">
                            <source src="assets/img/Background Blindtest July 3.gif" type="img/gif">
                          </video>
                          
                        <input class="checkbox" type="checkbox" id="reg-log" name="reg-log"/>
                            <label class="" for="reg-log"> </label>
                        <div class="card-3d-wrap mx-auto">
                            <div class="textCard">
                                <p>log in</p>
                                <p>sign up</p>
                            </div>
                            <div class="card-3d-wrapper">
                                <div class="card-front">
                                    <div class="center-wrap">
                                        <div class="section text-center">
                                            <h4 id="loginh4" class="mb-4 pb-3">Log In</h4>
                                            <form action="/login" method="POST">
                                                <div class="form-group">
                                                    <input type="text" name="logemail/loguser" class="form-style" placeholder="Your Email / Username" id="logemail" autocomplete="off" required>
                                                    <i class="input-icon uil uil-at"></i>
                                                    <div id="notAnUserError" class="error" style="color: red;"></div>
                                                </div>  
                                                <div class="form-group mt-2">
                                                    <input type="password" name="logpass" class="form-style" placeholder="Your Password" id="logpass" autocomplete="off" required>
                                                    <i class="input-icon uil uil-lock-alt"></i>
                                                    <div id="wrongPasswordError" class="error" style="color: red;"></div>
                                                </div>     
                                                <button type="submit" id="logsubmit" class="btn mt-4 btndynamics">Log In</button>                                   
                                                <p id="Forgot" class="mb-0 mt-4 text-center"><a href="#0" class="link">Forgot your password?</a></p>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-back">
                                    <div class="center-wrap">
                                        <div class="section text-center">
                                            <h4 id="signuph4" class="mb-4 pb-3">Sign Up</h4>
                                            <!-- Formulaire d'inscription. Envoie les données à la fonction JS pour vérification, puis à la base de données si tout est correct -->
                                            <form action="/signup" method="POST">
                                                <div class="form-group">
                                                    <input type="text" name="signname" class="form-style" placeholder="Username"  id="signname" autocomplete="off" required>
                                                    <i class="input-icon uil uil-user"></i>
                                                    <div id="usernameUsedError" class="error" style="color: red;"></div>
                                                </div>  
                                                <div class="form-group mt-2">
                                                    <input type="email" name="signemail" class="form-style" placeholder="Your Email" id="signemail" autocomplete="off" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,}$" title="L'adresse e-mail doit suivre le format: a@a.com" required>                                                    <i class="input-icon uil uil-at"></i>
                                                    <i class="input-icon uil uil-at"></i>
                                                    <div id="emailUsedError" class="error" style="color: red;"></div>
                                                </div>  
                                                <div class="form-group mt-2">
                                                    <input type="password" name="signpass" class="form-style" placeholder="Your Password" minlength="12" id="signpass" autocomplete="off" required>
                                                    <i class="input-icon uil uil-lock-alt"></i>
                                                    <div id="passwordConformityError" class="error" style="color: red;"></div>
                                                </div>
                                                <div class="form-group mt-2">
                                                    <input type="password" name="signpass2" class="form-style" placeholder="Confirmation Password" id="signpass2" autocomplete="off" required>
                                                    <i class="input-icon uil uil-lock-alt"></i>
                                                    <div id="passwordMismatchError" class="error" style="color: red;"></div>  
                                                </div>
                                                <button type="submit" id="signsubmit" class="btn mt-4 btndynamics">Sign Up</button>
                                            </form>     
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>

    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('logemail').addEventListener('input', function() {
            var username = document.getElementById('logemail').value
            $.ajax({
                url: '/isUserInDB', 
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({username: username}),
                success: function(response) {
                    if (response === false || response === 'false' || (response !== 'email' && response !== 'username')) {
                        console.log("User doesn't exist.")
                        document.getElementById('notAnUserError').textContent = 'Cet utilisateur n\'existe pas.';
                        document.getElementById('logsubmit').classList.add('disabled');
                        document.getElementById('logsubmit').classList.remove('btndynamics');
                        document.getElementById('logsubmit').disabled = true;
                    } else {
                        console.log("User exists.")
                        document.getElementById('notAnUserError').textContent = '';
                        document.getElementById('logsubmit').classList.remove('disabled');
                        document.getElementById('logsubmit').classList.add('btndynamics');
                        document.getElementById('logsubmit').disabled = false;
                    }
                }
            });
        })

        document.getElementById('logpass').addEventListener('input', function() {
            var password = document.getElementById('logpass').value
            $.ajax({
                url: '/isPasswordCorrect', 
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({password: password, username: document.getElementById('logemail').value}),
                success: function(response) {
                    if (response === 'false') {
                        console.log("Wrong password.")
                        document.getElementById('wrongPasswordError').textContent = 'Le mot de passe est incorrect.';
                        document.getElementById('logsubmit').classList.add('disabled');
                        document.getElementById('logsubmit').classList.remove('btndynamics');
                        document.getElementById('logsubmit').disabled = true;
                    } else {
                        console.log("Correct password.")
                        document.getElementById('wrongPasswordError').textContent = '';
                        document.getElementById('logsubmit').classList.remove('disabled');
                        document.getElementById('logsubmit').classList.add('btndynamics');
                        document.getElementById('logsubmit').disabled = false;
                    }
                }
            });
        });

        document.getElementById('signname').addEventListener('input', function() {
            var username = document.getElementById('signname').value
            $.ajax({
                url: '/checkUsername', 
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({username: username}),
                success: function(response) {
                    if (response === 'true') {
                        document.getElementById('usernameUsedError').textContent = 'Ce nom d\'utilisateur est déjà utilisé.';
                        document.getElementById('signsubmit').classList.add('disabled');
                        document.getElementById('signsubmit').classList.remove('btndynamics');
                        document.getElementById('signsubmit').disabled = true;
                    } else {
                        document.getElementById('usernameUsedError').textContent = '';
                        document.getElementById('signsubmit').classList.remove('disabled');
                        document.getElementById('signsubmit').classList.add('btndynamics');
                        document.getElementById('signsubmit').disabled = false;
                    }
                }
            });
        });

        document.getElementById('signemail').addEventListener('input', function() {
            var email = document.getElementById('signemail').value
            $.ajax({
                url: '/checkEmail', 
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({email: email}),
                success: function(response) {
                    if (response === 'invalid') {
                        document.getElementById('emailUsedError').textContent = 'Une adresse e-mail valide est requise.';
                        document.getElementById('signsubmit').classList.add('disabled');
                        document.getElementById('signsubmit').classList.remove('btndynamics');
                        document.getElementById('signsubmit').disabled = true;
                    } else if (response === 'true') {
                        document.getElementById('emailUsedError').textContent = 'Cet e-mail est déjà utilisé.';
                        document.getElementById('signsubmit').classList.add('disabled');
                        document.getElementById('signsubmit').classList.remove('btndynamics');
                        document.getElementById('signsubmit').disabled = true;
                    } else {
                        document.getElementById('emailUsedError').textContent = '';
                        document.getElementById('signsubmit').classList.remove('disabled');
                        document.getElementById('signsubmit').classList.add('btndynamics');
                        document.getElementById('signsubmit').disabled = false;
                    }
                }
            });
        });

        document.getElementById('signpass').addEventListener('input', function() {
            var password = document.getElementById('signpass').value
            $.ajax({
                url: '/isPasswordValid', 
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({password: password}),
                success: function(response) {
                    if (response === 'false') {
                        document.getElementById('passwordConformityError').textContent = 'Le mot de passe n\'est pas assez complexe.';
                        document.getElementById('signsubmit').classList.add('disabled');
                        document.getElementById('signsubmit').classList.remove('btndynamics');
                        document.getElementById('signsubmit').disabled = true;
                    } else {
                        document.getElementById('passwordConformityError').textContent = '';
                        document.getElementById('signsubmit').classList.remove('disabled');
                        document.getElementById('signsubmit').classList.add('btndynamics');
                        document.getElementById('signsubmit').disabled = false;
                    }
                }
            });
        });

        document.getElementById('signpass2').addEventListener('input', function() {
            var password = document.getElementById('signpass').value
            var password2 = document.getElementById('signpass2').value
            if (password !== password2) {
                document.getElementById('passwordMismatchError').textContent = 'Les mots de passe ne correspondent pas.';
                document.getElementById('signsubmit').classList.add('disabled');
                document.getElementById('signsubmit').classList.remove('btndynamics');
                document.getElementById('signsubmit').disabled = true;
            } else {
                document.getElementById('passwordMismatchError').textContent = '';
                document.getElementById('signsubmit').classList.remove('disabled');
                document.getElementById('signsubmit').classList.add('btndynamics');
                document.getElementById('signsubmit').disabled = false;
            }
        });
    });
    </script>
</html>
