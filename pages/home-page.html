<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage</title>
    <link rel="stylesheet" href="assets/css/homepage.css">
</head>    
<body>
    <div class="esection">
        <div class="container">
            <div class="row full-height justify-content-center">
                <div class="col-12 text-center align-self-center py-5">
                    <div class="section pb-5 pt-5 pt-sm-2 text-center" id="panel-container">
                        <video autoplay muted loop id="bg-video">
                            <source src="assets/img/Background Blindtest July 3.gif" type="img/gif">
                          </video>
                          
                        <input class="checkbox" type="checkbox" id="reg-log" name="reg-log"/>
                            <label class="" for="reg-log"> </label>
                        <div class="card-3d-wrap mx-auto">
                            <div class="textCard">
                                <p>log in</p>
                                <p>sign up</p>
                            </div>
                            <div class="card-3d-wrapper">
                                <div class="card-front">
                                    <div class="center-wrap">
                                        <div class="section text-center">
                                            <h4 id="loginh4" class="mb-4 pb-3">Log In</h4>
                                            <form action="/login" method="POST" id="logForm">
                                                <div class="form-group">
                                                    <input type="text" name="logemail/loguser" class="form-style" placeholder="Your Email / Username" id="logemail" autocomplete="off" required>
                                                    <i class="input-icon uil uil-at"></i>
                                                    <div id="notAnUserError" class="error" style="color: red;"></div>
                                                </div>  
                                                <div class="form-group mt-2">
                                                    <input type="password" name="logpass" class="form-style" placeholder="Your Password" id="logpass" autocomplete="off" required>
                                                    <i class="input-icon uil uil-lock-alt"></i>
                                                    <div id="wrongPasswordError" class="error" style="color: red;"></div>
                                                </div>     
                                                <button type="submit" id="logsubmit" class="btn mt-4 disabled" disabled>Log In</button>                                   
                                                <p id="Forgot" class="mb-0 mt-4 text-center"><a href="#0" class="link">Forgot your password?</a></p>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-back">
                                    <div class="center-wrap">
                                        <div class="section text-center">
                                            <h4 id="signuph4" class="mb-4 pb-3">Sign Up</h4>
                                            <form method="POST" id="registerForm" action="/register">
                                                <div class="form-group">
                                                    <input type="text" name="signname" class="form-style" placeholder="Username"  id="signname" autocomplete="off" required>
                                                    <i class="input-icon uil uil-user"></i>
                                                    <div id="usernameUsedError" class="error" style="color: red;"></div>
                                                </div>  
                                                <div class="form-group mt-2">
                                                    <input type="email" name="signemail" class="form-style" placeholder="Your Email" id="signemail" autocomplete="off" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,}$" title="L'adresse e-mail doit suivre le format: a@a.com" required>                                                    <i class="input-icon uil uil-at"></i>
                                                    <i class="input-icon uil uil-at"></i>
                                                    <div id="emailUsedError" class="error" style="color: red;"></div>
                                                </div>  
                                                <div class="form-group mt-2">
                                                    <input type="password" name="signpass" class="form-style" placeholder="Your Password" minlength="12" id="signpass" autocomplete="off" required>
                                                    <i class="input-icon uil uil-lock-alt"></i>
                                                    <div id="passwordConformityError" class="error" style="color: red;"></div>
                                                </div>
                                                <div class="form-group mt-2">
                                                    <input type="password" name="signpass2" class="form-style" placeholder="Confirmation Password" id="signpass2" autocomplete="off" required>
                                                    <i class="input-icon uil uil-lock-alt"></i>
                                                    <div id="passwordMismatchError" class="error" style="color: red;"></div>  
                                                </div>
                                                <button id="signsubmit" class="btn mt-4 btndynamics" type="button">Sign Up</button>
                                            </form>     
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById(('logemail')).addEventListener('input', function() {
                event.preventDefault();
                var username = document.getElementById('logemail').value;
                var password = document.getElementById('logpass').value;
                $.ajax({
                    url: '/loginControl',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({username: username, password: password}),
                    success: function(response) {
                        if (response === 'true') {
                            document.getElementById('wrongPasswordError').textContent = '';
                            document.getElementById('logsubmit').classList.remove('disabled');
                            document.getElementById('logsubmit').classList.add('btndynamics');
                            document.getElementById('logsubmit').disabled = false;
                        } else {
                            document.getElementById('wrongPasswordError').textContent = 'Identifiants incorrects.';
                            document.getElementById('logsubmit').classList.add('disabled');
                            document.getElementById('logsubmit').classList.remove('btndynamics');
                            document.getElementById('logsubmit').disabled = true;
                        }
                    }
                });
            });
            document.getElementById(('logpass')).addEventListener('input', function() {
                event.preventDefault();
                var username = document.getElementById('logemail').value;
                var password = document.getElementById('logpass').value;
                $.ajax({
                    url: '/loginControl',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({username: username, password: password}),
                    success: function(response) {
                        if (response === 'true') {
                            document.getElementById('wrongPasswordError').textContent = '';
                            document.getElementById('logsubmit').classList.remove('disabled');
                            document.getElementById('logsubmit').classList.add('btndynamics');
                            document.getElementById('logsubmit').disabled = false;
                        } else {
                            document.getElementById('wrongPasswordError').textContent = 'Identifiants incorrects.';
                            document.getElementById('logsubmit').classList.add('disabled');
                            document.getElementById('logsubmit').classList.remove('btndynamics');
                            document.getElementById('logsubmit').disabled = true;
                        }
                    }
                });
            });
            

            document.getElementById('signsubmit').addEventListener('click', function() {
                console.log('registering');
                var username = document.getElementById('signname').value
                var email = document.getElementById('signemail').value
                var password = document.getElementById('signpass').value
                var password2 = document.getElementById('signpass2').value
                
                $.ajax({
                    url: '/registerControl',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({username: username, email: email, password: password, password2: password2}),
                    success: function(response) {
                        console.log(username, email, password, password2, response);

                        document.getElementById('usernameUsedError').textContent = '';
                        document.getElementById('emailUsedError').textContent = '';
                        document.getElementById('passwordConformityError').textContent = '';
                        document.getElementById('passwordMismatchError').textContent = '';
                        
                        if (response === 'usernameInDB') {
                            document.getElementById('usernameUsedError').textContent = 'Ce nom d\'utilisateur est déjà utilisé.';
                        }
                        if (response === 'userEmpty') {
                            document.getElementById('usernameUsedError').textContent = 'Le nom d\'utilisateur ne peut pas être vide.';
                        }
                        if (response === 'emailInDB') {
                            document.getElementById('emailUsedError').textContent = 'Cet e-mail est déjà utilisé.';
                        }
                        if (response === 'emailInvalid') {
                            document.getElementById('emailUsedError').textContent = 'Une adresse e-mail valide est requise.';
                        }
                        if (response === 'emailEmpty') {
                            document.getElementById('emailUsedError').textContent = 'L\'adresse e-mail ne peut pas être vide.';
                        }
                        if (response === 'passwordEntropy') {
                            document.getElementById('passwordConformityError').textContent = 'Le mot de passe n\'est pas assez complexe.';
                        }
                        if (response === 'passwordEmpty') {
                            document.getElementById('passwordConformityError').textContent = 'Le mot de passe ne peut pas être vide.';
                        }
                        if (response === 'passwordMismatchError') {
                            document.getElementById('passwordMismatchError').textContent = 'Les mots de passe ne correspondent pas.';
                        } 
                        if (response === 'true') {
                            document.getElementById('usernameUsedError').textContent = '';
                            document.getElementById('emailUsedError').textContent = '';
                            document.getElementById('passwordConformityError').textContent = '';
                            document.getElementById('passwordMismatchError').textContent = '';
                            document.getElementById('registerForm').submit();
                        }
                    }
                });
            });
        });
    </script>
</html>
